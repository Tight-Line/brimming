<% content_for(:title) { "#{@space.name} - Brimming" } %>

<div class="space-header space-header-compact">
  <div class="space-header-main">
    <div class="space-header-info">
      <h1><%= @space.name %></h1>
      <% if @space.description.present? %>
        <p class="space-description"><%= @space.description %></p>
      <% end %>
    </div>
    <div class="space-header-actions">
      <%= render "shared/subscribe_button", space: @space %>
    </div>
  </div>
  <% if policy(@space).update? || policy(@space).manage_moderators? || policy(@space).manage_publishers? %>
    <div class="admin-actions">
      <% if policy(@space).update? %>
        <%= link_to "Edit", edit_space_path(@space), class: "btn btn-small btn-secondary" %>
      <% end %>
      <% if policy(@space).manage_moderators? %>
        <%= link_to "Moderators", moderators_space_path(@space), class: "btn btn-small btn-secondary" %>
      <% end %>
      <% if policy(@space).manage_publishers? %>
        <%= link_to "Publishers", publishers_space_path(@space), class: "btn btn-small btn-secondary" %>
      <% end %>
      <% if current_user&.can_moderate?(@space) && LlmService.available? %>
        <%= link_to "Q&A Wizard", space_qa_wizard_path(@space), class: "btn btn-small btn-primary" %>
      <% end %>
      <% if policy(@space).destroy? %>
        <%= button_to "Delete", space_path(@space), method: :delete,
            class: "btn btn-small btn-danger",
            data: { turbo_confirm: "Are you sure you want to delete this space?" } %>
      <% end %>
    </div>
  <% end %>
</div>

<% has_articles = @articles.any? %>
<% has_questions = @questions.any? %>
<% show_side_by_side = has_articles && has_questions %>

<div class="space-content-grid<%= ' side-by-side' if show_side_by_side %>">
  <% if has_articles %>
  <div class="card">
    <div class="card-header">
      <h2>Articles (<%= @articles.size %>)</h2>
    </div>

    <ul class="article-list">
      <% @articles.limit(10).each do |article| %>
        <li class="article-item">
          <div class="article-title">
            <%= link_to article.title, article_path(article) %>
          </div>
          <div class="article-meta">
            <span>by <%= render 'shared/user_badge', user: article.user %></span>
            <span><%= time_ago_in_words(article.created_at) %> ago</span>
          </div>
        </li>
      <% end %>
    </ul>
    <% if @articles.size > 10 %>
      <div class="card-footer">
        <%= link_to "View all #{@articles.size} articles", articles_path(space: @space.slug), class: "btn btn-small btn-secondary" %>
      </div>
    <% end %>
  </div>
  <% end %>

  <div class="card">
    <div class="card-header">
      <h2>Questions (<%= @questions.size %>)</h2>
    </div>

    <% if has_questions %>
      <ul class="question-list">
        <% @questions.limit(10).each do |question| %>
          <li class="question-item">
            <div class="question-title">
              <%= link_to question.title, question_path(question) %>
            </div>
            <div class="question-meta">
              <span>by <%= render 'shared/user_badge', user: question.author %></span>
              <span><%= question.answers_count %> answers</span>
              <% if question.has_correct_answer? %>
                <span class="badge badge-success">Solved</span>
              <% end %>
            </div>
          </li>
        <% end %>
      </ul>
      <% if @questions.size > 10 %>
        <div class="card-footer">
          <%= link_to "View all #{@questions.size} questions", questions_path(space: @space.slug), class: "btn btn-small btn-secondary" %>
        </div>
      <% end %>
    <% else %>
      <div class="empty-state">
        <p>No questions in this space yet.</p>
      </div>
    <% end %>
  </div>
</div>
