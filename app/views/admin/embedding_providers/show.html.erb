<% content_for(:title) { "#{@embedding_provider.name} - Embedding Providers - Admin - Brimming" } %>

<div class="admin-container">
  <div class="page-header">
    <h1><%= @embedding_provider.name %></h1>
    <div class="actions">
      <%= link_to "Edit", edit_admin_embedding_provider_path(@embedding_provider), class: "btn btn-secondary" %>
      <%= link_to "Back to List", admin_embedding_providers_path, class: "btn btn-link" %>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <h3>Provider Configuration</h3>
    </div>
    <div class="card-body">
      <dl class="details-list">
        <dt>Status</dt>
        <dd>
          <% if @embedding_provider.enabled? %>
            <span class="badge badge-success">Enabled</span>
          <% else %>
            <span class="badge badge-secondary">Disabled</span>
          <% end %>
        </dd>

        <dt>Provider Type</dt>
        <dd><%= @embedding_provider.display_provider_type %></dd>

        <dt>Model</dt>
        <dd><code><%= @embedding_provider.embedding_model %></code></dd>

        <dt>Dimensions</dt>
        <dd><%= @embedding_provider.dimensions %></dd>

        <% if @embedding_provider.requires_api_key? %>
          <dt>API Key</dt>
          <dd>
            <% if @embedding_provider.api_key.present? %>
              <span class="badge badge-success">Configured</span>
            <% else %>
              <span class="badge badge-warning">Not configured</span>
            <% end %>
          </dd>
        <% end %>

        <% if @embedding_provider.requires_api_endpoint? %>
          <dt>API Endpoint</dt>
          <dd><code><%= @embedding_provider.api_endpoint.presence || "(not set)" %></code></dd>
        <% end %>
      </dl>
    </div>
  </div>

  <div class="card mt-4">
    <div class="card-header">
      <h3>Usage Statistics</h3>
    </div>
    <div class="card-body">
      <% question_count = Question.not_deleted.count %>
      <% embedded_question_count = Question.not_deleted.where.not(embedded_at: nil).count %>
      <% article_count = Article.active.count %>
      <% embedded_article_count = Article.active.where.not(embedded_at: nil).count %>
      <% total_chunks = Chunk.count %>
      <% question_coverage = question_count > 0 ? (embedded_question_count.to_f / question_count * 100).round(1) : 0 %>
      <% article_coverage = article_count > 0 ? (embedded_article_count.to_f / article_count * 100).round(1) : 0 %>

      <dl class="details-list">
        <dt>Questions with Embeddings</dt>
        <dd><%= embedded_question_count %> / <%= question_count %> (<%= question_coverage %>%)</dd>

        <dt>Articles with Embeddings</dt>
        <dd><%= embedded_article_count %> / <%= article_count %> (<%= article_coverage %>%)</dd>

        <dt>Total Chunks</dt>
        <dd><%= total_chunks %></dd>

        <dt>Vector Dimensions</dt>
        <dd><%= @embedding_provider.dimensions %></dd>
      </dl>

      <% if (question_coverage < 100 || article_coverage < 100) && @embedding_provider.enabled? %>
        <div class="health-progress mt-3">
          <div class="progress-bar" style="width: <%= [question_coverage, article_coverage].min %>%"></div>
        </div>
        <small class="text-muted">Embeddings are generated in the background. New content is embedded automatically.</small>
      <% end %>
    </div>
  </div>
</div>
